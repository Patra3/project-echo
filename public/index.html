<!DOCTYPE html>

<!--

TO-DO list app

-->

<html>
  <head>
    <title>Project Echo</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="todo,project,productivity">
    <meta name="author" content="Chen Z/Jason Z">
    <meta name="description" content="Powerful todo list.">
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- GOOGLE FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Parkinsans:wght@300..800&display=swap" rel="stylesheet">
    
    <!-- BUFFER -->
    <script src="bundle.js"></script>

    <!-- FEATHER -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Markdown editor -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>

    <!-- coloris -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@0.24.0/dist/coloris.min.css"/>
    <script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@0.24.0/dist/coloris.min.js"></script>

    <style>
      * {
        font-family: "Parkinsans", sans-serif;
      }
      .page {
        display: none;
      }
      .views {
        display: none;
      }
      #profile-menu {
        cursor: pointer;
        padding-right: 0.5rem;
      }
      #profile-menu:hover {
        border-radius: 20px;
        background-color: #ededed;
      }
      #offcanvas-toggler {
        border:0;
      }
      #logoutButton {
        cursor: pointer;
        color: lightcoral;
      }
      #logoutButton:hover {
        background-color: #ffd7d4;
        border-radius: 5px;
      }
      .nav-item {
        cursor: pointer;
      }
      #viewSettingsBtn {  
        border-style: solid;
        border-width: 2px;
        border-color: black;
      }
      #viewSettingsBtn:hover {
        background-color: black;
        color: white;
      }
      .checkbox-round {
        width: 1.3em;
        height: 1.3em;
        background-color: white;
        border-radius: 50%;
        vertical-align: middle;
        border: 1px solid #ddd;
        appearance: none;
        -webkit-appearance: none;
        outline: none;
        cursor: pointer;
      }

      .checkbox-round:checked {
        background-color: gray;
      }
    </style>
  </head>
  <body>

    <!-- pages -->
    <div class="pages">
      <div id="auth" class="container">
        <br>  
        <!-- login block -->
        <div class="card">
          <h5 class="card-header">Login</h5>
          <div class="card-body">
            <form onsubmit="tryLogin();" action="javascript:void(0);">
              <div class="mb-3">
                <label for="login-username" class="form-label">Username</label>
                <input type="text" class="form-control" id="login-username">
              </div>
              <div class="mb-3">
                <label for="login-password" class="form-label">Password</label>
                <input type="password" class="form-control" id="login-password">
              </div>
              <button type="submit" class="btn btn-primary">Login</button>
            </form>
          </div>
        </div>

        <br><br>

        <!-- register block -->
        <div class="card">
          <h5 class="card-header">Don't have an account?</h5>
          <div class="card-body">
            <p>Unfortunately we are in an invite-only private phase. If you do not already have or know your login, there is no way to 
              get access to our service at this time. Please check back for additional updates on our service. Thank you.</p>
          </div>
        </div>

      </div>
      <div id="main-page" class="page">
        <nav class="navbar fixed-bottom bg-body-tertiary">
          <div class="container-fluid">
            <a class="navbar-brand navbar-right" href="#"><b>Project Echo</b>&nbsp;<i data-feather="check"></i></a>
            <button id="offcanvas-toggler" class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#navbar-offcanvas">
              <span class="navbar-toggler-icon"></span>
            </button>
            <!-- main menu offcanvas -->
            <div class="offcanvas offcanvas-end" tabindex="-1" id="navbar-offcanvas">
              <div class="offcanvas-header">
                <h5 id="profile-menu" class="offcanvas-title" data-bs-dismiss="offcanvas"><img class="self-pfp" style="width:3rem;border-radius:50%;">&nbsp; <span id="greeting">test</span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
              </div>
              <div class="offcanvas-body">
                <h6 id="currentVault">Currently viewing: Personal Vault</h6><br>
                <ul class="nav nav-pills flex-column">
                  <li class="nav-item">
                    <a data-bs-dismiss="offcanvas" id="tasks-view-item" class="nav-link active" aria-current="page" onclick="changePage('tasks-view')">Tasks</a>
                  </li>
                  <li class="nav-item">
                    <a data-bs-dismiss="offcanvas" id="filters-view-item" class="nav-link" aria-current="page" onclick="changePage('filters-view')">Filters</a>
                  </li>
                  <li class="nav-item">
                    <a data-bs-dismiss="offcanvas" id="vaults-view-item" class="nav-link" onclick="changePage('vaults-view')">Vaults</a>
                  </li>
                  <li class="nav-item">
                    <a data-bs-dismiss="offcanvas" id="tags-view-item" class="nav-link" onclick="changePage('tags-view')">Tags</a>
                  </li>
                  <li class="nav-item">
                    <a data-bs-dismiss="offcanvas" id="people-view-item" class="nav-link" onclick="changePage('people-view')">People</a>
                  </li>
                  <li class="nav-item">
                    <a data-bs-dismiss="offcanvas" id="settings-view-item" class="nav-link" onclick="changePage('settings-view')">Settings</a>
                  </li>
                  <li class="nav-item" id="logoutButton">
                    <a class="nav-link" style="color: lightcoral;">Log Out</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </nav>
        <br>
        <div class="container">
          <div>
            <div id="filters-view" class="views">
              <h4>My filters</h4>
              <p>Here you can add, edit and delete filters which will filter out tasks from your view depending on how you define it.</p>
              
              <br>
              <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"">
                  Select a filter to edit or add
                </button>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item">Action</a></li>
                  <li><a class="dropdown-item">Another action</a></li>
                  <li><a class="dropdown-item">Add new filter</a></li>
                </ul>
              </div><br><br>
              <h6>Filter 1</h6>
            </div>
            <div id="tasks-view">
              <h4>Task View</h4>
              <p id="clock-statement">Clock: 8:13pm</p>
              <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#taskEditorOffcanvas"><i data-feather="plus-circle"></i> &nbsp;New Task</button>
              <button id="viewSettingsBtn" class="btn btn-white" type="button" data-bs-toggle="offcanvas" data-bs-target="#taskSettingsOffcanvas"><i data-feather="settings"></i> &nbsp;Task View settings</button>
              
              <!-- new task offcanvas -->
              <div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="taskEditorOffcanvas">
                <div class="offcanvas-header">
                  <h5 class="offcanvas-title">Task Editor</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                </div>
                <div class="offcanvas-body">
                  <form>
                    <div class="mb-3">
                      <label for="task-name" class="form-label">Task Name</label>
                      <input type="text" class="form-control" id="task-name" name="task-name">
                    </div>
                    <div class="mb-3">
                      <label for="task-description" class="form-label">Task Description</label>
                      <textarea class="form-control" id="task-description" name="task-description"></textarea>
                    </div>
                    <div class="mb-3">
                      <label for="task-duedate" class="form-label">Due At</label>
                      <input type="datetime-local" class="form-control" id="task-duedate" name="task-duedate" required>
                    </div>
                    <!-- this is dynamic -->
                    <div class="mb-3">
                      <label class="form-label" for="tda2">Task Tags</label>
                      <div class="form-control" id="tda2">
                        <div class="row row-col-7" id="task-tags"></div>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label" for="task-priority">Task Priority</label>
                      <input type="number" max="5" min="1" step="1" value="1" class="form-control" id="task-priority" name="task-priority" required>
                    </div>
                  </form>
                </div>
              </div>
              <script>
                let taskDescription = new SimpleMDE({
                  element: document.getElementById('task-description')
                });
              </script>
              <!-- task settings offcanvas -->
              <div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="taskSettingsOffcanvas">
                <div class="offcanvas-header">
                  <h5 class="offcanvas-title">Task view settings</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                </div>
                <div class="offcanvas-body">
                  <form id="taskViewForm">
                    <div class="mb-3">
                      <label for="groupBySelector" class="form-label">Group tasks by: </label>
                      <select name="groupBy" id="groupBySelector" form="taskViewForm" class="form-control">
                        <option value="test">test</option>
                      </select>
                      <div class="form-text">Select how you want your tasks to be grouped together</div>
                    </div>
                    <div class="mb-3">
                      <label for="orderBySelector" class="form-label">Order inside group: </label>
                      <select name="orderBy" id="orderBySelector" form="taskViewForm" class="form-control">
                        <option value="test">test</option>
                      </select>
                      <div class="form-text">Select how to order your tasks inside the groups</div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <div id="vaults-view" class="views">
              <h4>Vaults</h4>
              <p>Each vault contains separate tasks and tags. You can share vaults with others.</p><br><br>
              <div id="vaults">
                <div class="card">
                  <div class="card-body">
                    <h5 class="card-title">(Current) Personal Vault</h5>
                    <small>
                    <i data-feather="users" style="width: 1rem;"></i> 3 people
                    &nbsp;
                    <i data-feather="check-circle" style="width: 1rem;"></i> 5 tasks
                    &nbsp;
                    <i data-feather="calendar" style="width: 1rem;"></i> Upcoming task in 3 days
                  </small>
                  </div>
                  <div class="card-body">
                    <button type="button" class="btn btn-primary">Go to vault</button>
                    <button type="button" class="btn btn-secondary">Edit vault</button>
                    <button type="button" class="btn btn-danger">Delete vault</button>
                  </div>
                </div>
              </div>
            </div>
            <div id="tags-view" class="views">
              <div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="tagsEditOffcanvas">
                <div class="offcanvas-header">
                  <button type="button" class="btn btn-danger" id="tag2-delete">Delete tag</button>
                  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                  <form onsubmit="editTag();" action="javascript:void(0);">
                    <div class="mb-3">
                      <label for="tag2-name" class="form-label">Tag name</label>
                      <input type="text" class="form-control" id="tag2-name" name="tag-name" required>
                    </div>
                    <div class="mb-3" style="position: relative;" id="tag2-anchor">
                      <label for="tag2-color" class="form-label">Tag color</label><br>
                      <input id="tag2-color" pattern="^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$" name="tag-color" type="text" class="form-control" required data-coloris>
                    </div>
                    <button type="submit" class="btn btn-primary">Edit tag</button>
                  </form><br><br><br><br>
                </div>
              </div>
              <h4>Tags Editor</h4>
              <p>Tags are labels you can apply to your tasks, which help you group and organize them.<br>
                If tags are shown below, press on one to edit it.
              </p>
              <br>
              <!-- dynamic insert -->
              <div id="tag-editor-list"></div><br><br>
              <div class="card">
                <div class="card-header">
                  Add new tag
                </div>
                <div class="card-body">
                  <form onsubmit="createNewTag();" action="javascript:void(0);">
                    <div class="mb-3">
                      <label for="tag-name" class="form-label">Tag name</label>
                      <input type="text" class="form-control" id="tag-name" name="tag-name" required>
                    </div>
                    <div class="mb-3">
                      <label for="tag-color" class="form-label">Tag color</label><br>
                      <input id="tag-color" pattern="^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$" name="tag-color" type="text" class="form-control" required data-coloris>
                    </div>
                    <button type="submit" class="btn btn-primary">Create tag</button>
                  </form>
                </div>
              </div><br>
              <button type="button" class="btn btn-danger w-100" onclick="deleteTag(-1, true);">Clear all tags</button>
              <br><br><br><br>
            </div>
            <div id="people-view" class="views">
              g
            </div>
            <div id="settings-view" class="views">
              b
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>

      Coloris({
        themeMode: 'pill'
      });

      feather.replace();

      window.setInterval(() => {

      }, 1000);

      // Equivalent to NodeJS from buffer.
      const Buffer = deff.Buffer.Buffer;

      let currentPage = 'auth';

      function changePage(newPage){
        if (currentPage != newPage){
          if (currentPage != 'main-view'){
            gebi(currentPage).style.display = 'none';
          }
          gebi(newPage).style.display = 'block';
          // Remove active element class.
          if (newPage.includes('view')){
            gebi(`${currentPage}-item`).classList.remove('active');
            gebi(`${newPage}-item`).classList.add('active');
            location.hash = newPage;
          }
          currentPage = newPage;
        }
      }

      let storage = {
        write: (key, value) => {
          localStorage.setItem(key, JSON.stringify([value]));
        },
        read: key => {
          if (localStorage.getItem(key) == null){
            return -1;
          }
          return JSON.parse(localStorage.getItem(key))[0];
        },
        delete: key => {
          localStorage.removeItem(key);
        },
        clear: () => {
          localStorage.clear();
        }
      }

      let sessionToken = storage.read('sessionToken');
      let currentVaultId = storage.read('currentVaultId');
      let uid = -1;
      
      if (sessionToken != -1){
        changePage('main-page'); //main menu
        currentPage = 'tasks-view';
        // This lets us keep the app page open on a refresh or bookmark
        let locHash = location.hash.substring(1);
        if (gebi(`${locHash}`) != null){
          changePage(locHash);
        }
        // Update.
        refreshClient();
      }

      /**
       * Send API request to create new tag for the vault.
       */
      function createNewTag(){
        let d = gebi('tag-name'), c = gebi('tag-color');
        request(['createNewTag', sessionToken, currentVaultId, d.value, c.value]).then(data => {
          d.value = '';
          c.value = '';
          if (data.status === 'ERROR' || data.status === 'INVALID'){
            alert('An error has occurred. The app will restart now.');
            storage.clear();
            location.reload();
          }
          else{
            refreshClient();
          }
        });
      }
      
      function deleteTag(tagId, all = false){
        //console.log(tagId); 
        let verifyCheck = false;
        if (all){
          verifyCheck = window.prompt(`Please enter "delete all" to confirm.`) === 'delete all' ? true : false;
        }
        else{
          verifyCheck = window.prompt(`Please enter "delete" to confirm.`) === 'delete' ? true : false;
        }
        if (!verifyCheck){
          alert('Nothing was deleted.');
          return;
        }
        else{
          request(['deleteTag', sessionToken, tagId, all]).then(data => {
            if (data.status == 'ERROR' || data.status == 'INVALID'){
              alert('An error has occurred. The app will restart now.');
              storage.clear();
            }
            location.reload();
          });
        }
      }

      function editTag(){
        if (currentEditingTag == null){
          // We have nothing to edit
          location.reload();
        }
        else{
          let tagId = currentEditingTag;
          currentEditingTag = null;
          let newName = gebi('tag2-name').value, newColor = gebi('tag2-color').value;
          request(['updateTag', sessionToken, tagId, newName, newColor]).then(data => {
            if (data.status == 'ERROR' || data.status == 'INVALID'){
              alert('An error has occurred. The app will restart now.');
              storage.clear();
            }
            location.reload();
          });
        }
      }

      /**
       * Returns true if the hex color is bright.
       * 
       * DISCLAIMER: The following function below was written by
       * EliseoPlunker and GuTheR on StackOverflow under the
       * CreativeCommons Attribution-ShareAlike 4.0 International license
       * 
       * Link to author post: https://stackoverflow.com/a/77647094
       * No modifications have been made to this code.
       * 
       **/
      function isLightColor(color) {
        if (color.length == 7) {
          const rgb = [
            parseInt(color.substring(1, 3), 16),
            parseInt(color.substring(3, 5), 16),
            parseInt(color.substring(5), 16),
          ];
          const luminance =
            (0.2126 * rgb[0]) / 255 +
            (0.7152 * rgb[1]) / 255 +
            (0.0722 * rgb[2]) / 255;
          return luminance > 0.5;
        }
        return false;
      }

      function refreshClient(){
        let fetchStartTime = performance.now();
        request(['getClientPackageUpdate', sessionToken]).then(data => {
          let receivedTime = performance.now();
          if (data.status === 'INVALID'){
            storage.clear();
            location.reload();
          }
          else{
            window.data = data;
            // Set our uid
            uid = data.me.userid;
            // Set pfp for every location.
            let pd = data.me.pfp;
            console.log(data);
            let fileExt = pd.fileName.split('.')[1];
            let pdEmbedData = `data:image/${fileExt};base64,${Buffer.from(pd.hexData, 'hex').toString('base64')}`
            let doms = document.getElementsByClassName('self-pfp');
            for (let i = 0; i < doms.length; i++){
              let item = doms[i];
              item.src = pdEmbedData;
            }
            // Set current vault if not exist before.
            if (currentVaultId === -1){
              currentVaultId = data.groups[0].groupid;
              storage.write('currentVaultId', currentVaultId);
            }
            // Set greeting.
            gebi('greeting').innerHTML = `Hi, ${data.me.username}`;
            // Set vaults entries
            let vaultDom = gebi('vaults');
            vaultDom.innerHTML = '';
            data.groups.forEach(group => {
              let baseCard = document.createElement('div');
              if (currentVaultId === group.groupid){
                window.currentGroup = group;
              }
              baseCard.innerHTML = `
                  <div class="card">
                    <div class="card-body" data-groupid="${group.groupid}">
                      <h5 class="card-title">${currentVaultId === group.groupid ? '(Current) ' : ''}${group.groupname}</h5>
                      <small>
                      <i data-feather="users" style="width: 1rem;"></i> 3 people
                      &nbsp;
                      <i data-feather="check-circle" style="width: 1rem;"></i> 5 tasks
                      &nbsp;
                      <i data-feather="calendar" style="width: 1rem;"></i> Upcoming task in 3 days
                    </small>
                    </div>
                    <div class="card-body">
                      <button type="button" class="btn btn-primary" style="display:${(currentVaultId === group.groupid) ? 'none' : 'inline'};">Go to vault</button>
                      <button type="button" class="btn btn-secondary" style="display:${(group.adminid === uid) ? 'inline' : 'none'};">Edit vault</button>
                      <button type="button" class="btn btn-danger" style="display:${(group.adminid === uid) ? 'inline' : 'none'};">Delete vault</button>
                    </div>
                  </div>
              `;
              vaultDom.appendChild(baseCard);
              feather.replace();
            });
            // Set tags in the task editor.
            let taskEditorList = gebi('tag-editor-list');
            taskEditorList.innerHTML = '';
            window.currentTags = window.currentGroup.tags;
            console.log(window.currentTags);
            let taskTags = gebi('task-tags');
            taskTags.innerHTML = '';
            if (window.currentTags.length === 0){
              // No tags
              taskTags.innerHTML = `<div class="container">No tags found</div>`;
            }
            else{
              window.currentTags.forEach(tag => {
                let dom = document.createElement('div');
                dom.innerHTML = `
                  <button onclick="renderTagEditor(this.dataset.tagid)" data-tagid="${tag.tagid}" type="button" class="btn w-100" style="border-radius:0;background-color: ${tag.tagcolor};${isLightColor(tag.tagcolor) ? 'color: black;' : 'color: white;'}">${tag.tagname}</button>
                `;
                taskEditorList.appendChild(dom);
                
                // now create the selectors for new task
                dom = document.createElement('div');
                dom.classList = 'col';
                dom.innerHTML = `
                  <input type="checkbox" class="checkbox-round" id="task-tag-number${tag.tagid}" name="task-tag-number${tag.tagid}" value="${tag.tagname}">
                  <label for="task-tag-number${tag.tagid}" style="margin-top:5px;white-space:nowrap;cursor:pointer;padding:0.25rem;padding-left:0.40rem;padding-right:0.40rem;border-radius:25px;background-color:${tag.tagcolor};${isLightColor(tag.tagcolor) ? 'color: black;' : 'color: white;'}">${tag.tagname}</label><br>
                `;
                taskTags.appendChild(dom);
              });
              taskEditorList.style.display = 'none';
              taskEditorList.style.display = 'block';
            }
            /*
            <div class="col">
                            <input type="checkbox" class="checkbox-round" id="vehicle2" name="vehicle2" value="Car">
                            <label for="vehicle2"> I have a car</label><br>
                          </div>
            */
           let finishRenderingTime = performance.now();
           console.log(`Client rendering time: ${(finishRenderingTime - receivedTime).toFixed(3)}ms`);
           console.log(`Request-to-response performace time: ${(receivedTime - fetchStartTime).toFixed(3)}ms`);
           console.log(`%cRequest-to-finish time: ${(finishRenderingTime - fetchStartTime).toFixed(3)}ms`, 'color: green;');
          }
        });
      }
      let currentEditingTag = null;
      function renderTagEditor(id){
        let offcanvas = gebi('tagsEditOffcanvas');
        let b = new bootstrap.Offcanvas(offcanvas);
        offcanvas.addEventListener('hide.bs.offcanvas', () => {
          // A solution for bug that the color picker no longer works on add new tag.
          location.reload();
        });
        b.show();
        let o = gebi('tag2-color');
        let del = gebi('tag2-delete');
        del.onclick = () => {deleteTag(currentEditingTag)};
        window.currentTags.forEach(tag => {
          if (tag.tagid == id){
            gebi('tag2-name').value = tag.tagname;
            o.value = tag.tagcolor;
            o.dispatchEvent(new Event('input', { bubbles: true }));
          }
        });
        Coloris({
          parent: gebi('tag2-anchor'),
          el: gebi('tag2-color')
        });
        currentEditingTag = id;
      }

      /**
       * Request against the API
       * @param request Object
       * @param params Object
       * @return Object
       */
      async function request(request){
        try {
          const ret = await fetch('api/' + encodeURIComponent(JSON.stringify(request)));
          if (!ret.ok){
            throw new Error(`Response status: ${response.status}`);
          }
          return await ret.json();
        }
        catch (e) {
          //alert('Error in request, see console for details. Please refresh the page.');
          console.error(e.message);
        }
      }

      /**
       * Short getElementById wrapper
       */
      function gebi(id){
        return document.getElementById(id);
      }

      /**
       * Attempt to login and save the auth token.
       */
      function tryLogin(){
        request(['login', gebi('login-username').value, gebi('login-password').value]).then(val => {
          let status = val.status;
          if (status == 'OK'){
            // Let's save the session token.
            let sessionToken = val.token;
            storage.write('sessionToken', val.token);
            storage.write('sessionTokenExpires', val.expires);
            // Reload the page.
            location.reload();
          }
          else if (status == 'INVALID'){
            alert('The credentials are incorrect, please try again.');
          }
          else{
            alert('An unexpected error has occurred.');
            location.reload();
          }
        }).catch(e => {
          alert('An unexpected error has occurred.');
          console.error(e);
        });
      }
    </script>

  </body>
</html>