<!DOCTYPE html>

<!--

TO-DO list app

-->

<html>
  <head>
    <title>Project Echo</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="todo,project,productivity">
    <meta name="author" content="Chen Z/Jason Z">
    <meta name="description" content="Powerful todo list.">
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- GOOGLE FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&family=Nabla&family=Parkinsans:wght@300..800&display=swap" rel="stylesheet">

    <!-- FEATHER -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Markdown editor -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>

    <!-- coloris -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@0.24.0/dist/coloris.min.css"/>
    <script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@0.24.0/dist/coloris.min.js"></script>

    <!-- marked -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- DOM purify -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.2/dist/purify.min.js"></script>

    <script src="bundle.js"></script>
    
    <style>

      #clock-statement {
        font-family: 'DM Mono', monospace;
      }
      .center {
        display: block;
        margin-left: auto;
        margin-right: auto;
        width: 50%;
      }
      * {
        font-family: "Parkinsans", sans-serif;
      }
      .page {
        display: none;
      }
      .views {
        display: none;
      }
      #profile-view-item {
        cursor: pointer;
        padding-right: 0.5rem;
      }
      #profile-view-item:hover {
        border-radius: 20px;
        background-color: #ededed;
      }
      #offcanvas-toggler {
        border:0;
      }
      #inviteCode {
        color: white;
      }
      #inviteCode:hover, #inviteCode:active{
        color: black;
        cursor: pointer;
      }
      
      #logoutButton {
        cursor: pointer;
        color: lightcoral;
      }
      #logoutButton:hover {
        background-color: #ffd7d4;
        border-radius: 5px;
      }
      .nav-item {
        cursor: pointer;
      }
      #viewSettingsBtn {  
        border-style: solid;
        border-width: 2px;
        border-color: black;
      }
      #viewSettingsBtn:hover {
        background-color: black;
        color: white;
      }

      .task-mini-tag {
        font-family: 'DM Mono', monospace;
        font-size: 0.7em;
        border: 2px solid;
        border-radius: 15px;
        padding: 5px;
        cursor: default;
        user-select: none;
      }
      .checkbox-round {
        width: 1.3em;
        height: 1.3em;
        background-color: white;
        border-radius: 50%;
        vertical-align: middle;
        border: 1px solid #ddd;
        appearance: none;
        -webkit-appearance: none;
        outline: none;
        cursor: pointer;
      }

      .checkbox-round:checked {
        background-color: gray;
      }

      ::-webkit-scrollbar {
        width: 9px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background-color: rgba(155, 155, 155, 0.5);
        border-radius: 20px;
        border: transparent;
      }
      .overlay {
        height: 100%;
        width: 100%;
        display: none;
        position: fixed;
        z-index: 1200;
        top: 0;
        left: 0;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0, 0.6);
      }

      .overlay-content {
        user-select: none;
        color: white;
        position: relative;
        top: 25%;
        width: 100%;
        text-align: center;
        margin-top: 30px;
      }

      .overlay a {
        padding: 8px;
        text-decoration: none;
        font-size: 36px;
        color: #818181;
        display: block;
        transition: 0.3s;
      }

      .overlay a:hover, .overlay a:focus {
        color: #f1f1f1;
      }

      .overlay .closebtn {
        position: absolute;
        top: 20px;
        right: 45px;
        font-size: 60px;
      }

      @media screen and (max-height: 450px) {
        .overlay a {font-size: 20px}
        .overlay .closebtn {
        font-size: 40px;
        top: 15px;
        right: 35px;
        }
      }
      .fade-in {
        opacity: 1;
        animation-name: fadeInOpacity;
        animation-iteration-count: 1;
        animation-timing-function: ease-in;
        animation-duration: 5s;
      }
      @keyframes fadeInOpacity {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }
      .tricon {
        float: right;
        cursor: pointer;
        margin-left: 5px;
        margin-right: 5px
      }
    </style>
  </head>
  <body>

    <div id="loading_overlay" class="overlay fade-in">
      <div class="overlay-content">
        <h3>Loading, please wait...</h3>
        <div class="container">
          <div class="spinner-border text-light" role="status">
            <span class="sr-only">Loading...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- pages -->
    <div class="pages">
      <div id="auth" class="container">
        <br>  
        <h4><b>Project Echo</b>&nbsp;<i data-feather="check"></i></h4><br><br>
        <!-- login block -->
        <div class="card">
          <h5 class="card-header">Login</h5>
          <div class="card-body">
            <form onsubmit="tryLogin();" action="javascript:void(0);">
              <div class="mb-3">
                <label for="login-username" class="form-label">Username</label>
                <input type="text" class="form-control" id="login-username">
              </div>
              <div class="mb-3">
                <label for="login-password" class="form-label">Password</label>
                <input type="password" class="form-control" id="login-password">
              </div>
              <button type="submit" class="btn btn-primary">Login</button>
            </form>
          </div>
        </div>

        <br><br>

      </div>
      <div id="main-page" class="page">
        <nav class="navbar fixed-bottom" style="background-color: white;">
          <div class="container-fluid">
            <div onclick="changePage('tasks-view')" class="navbar-brand navbar-right" style="cursor:pointer;"><b>Project Echo</b>&nbsp;<i data-feather="check"></i></div>
            <button class="navbar-toggler" onclick="changePage('tasks-view')" type="button" style="border:0;outline:none;box-shadow:none;"><i data-feather="home"></i></button>
          </div>
        </nav>
        <div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="guide-offcanvas">
          <div class="offcanvas-header">
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
          </div>
          <div class="offcanvas-body" id="guide-body"></div>
        </div>
        <br>
        <div class="container">
          <div>
            <div id="filters-view" class="views">
              <h4>Filter Editor</h4>
              <p>Here you can add, edit and delete filters which will filter out tasks from your view depending on how you define it.</p>
              <br>
              <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                  Select a filter to edit or add
                </button>
                <ul class="dropdown-menu" id="filters-edit-list"></ul>
              </div><br><br>
              <div class="card">
                <div class="card-header" id="filter-title">
                  Editing Filter 1
                </div>
                <div class="card-body">
                  <form id="filter-form" action="javascript:void(0);" onsubmit="updateCurrentFilter()">
                    <div class="mb-3">
                      <label for="filter-name" class="form-label">Filter Name</label>
                      <input type="text" id="filter-name" name="filter-name" class="form-control" required>
                    </div>
                    <!-- dynamic -->
                    <div class="mb-3">
                      <label class="form-label" for="tda3">Include Tags</label>
                      <div class="form-control" id="tda3">
                        <div id="filter-tags" style="display: flex; flex-wrap: wrap;"></div>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label" for="filter-groupby">Group by</label>
                      <select id="filter-groupby" name="filter-groupby" class="form-control">
                        <option value="day">Day</option>
                        <option value="week">Week</option>
                        <option value="month">Month</option>
                        <option value="year">Year</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label class="form-label" for="filter-sortby">Sort by</label>
                      <select id="filter-sortby" name="filter-sortby" class="form-control">
                        <option value="priority">Priority</option>
                        <option value="title">Title (Alphabetical)</option>
                        <option value="duedate">Due Date</option>
                      </select>
                    </div>
                    <div class="mb-3" hidden>
                      <input type="checkbox" id="filter-isdone" name="filter-isdone">
                      <label for="filter-isdone" class="form-label">Is completed</label>&nbsp;
                      <input type="checkbox" id="filter-isnotdone" name="filter-isnotdone">
                      <label for="filter-isnotdone" class="form-label">Is not completed</label>
                    </div>
                    <div class="mb-3">
                      <label for="filter-descincludes" class="form-label">Description includes</label>
                      <input type="text" id="filter-descincludes" name="filter-descincludes" class="form-control">
                    </div>
                    <div class="mb-3">
                      <label for="filter-titleincludes" class="form-label">Title includes</label>
                      <input type="text" id="filter-titleincludes" name="filter-titleincludes" class="form-control">
                    </div>
                    <div class="mb-3">
                      <label for="filter-startdate" class="form-label">Start Date</label>
                      <input type="datetime-local" id="filter-startdate" name="filter-startdate" class="form-control">
                    </div>
                    <div class="mb-3">
                      <label for="filter-enddate" class="form-label">End Date</label>
                      <input type="datetime-local" id="filter-enddate" name="filter-enddate" class="form-control">
                    </div><br>
                    <button type="submit" class="btn btn-primary">Confirm</button>
                  </form>
                </div>
              </div>
              <br>
              <button type="button" class="btn btn-danger" onclick="deleteFilter();">Delete filter</button>
              <br><br><br><br>
            </div>
            <div id="tasks-view">
              <div class="row">
                <div class="col-11">
                  <h4>My Tasks</h4>
                  <p id="clock-statement">Clock: 8:13pm</p>
                </div>
                <div class="col-1">
                  <img class="self-pfp" style="width:2.4rem;border-radius:50%;float:right;cursor:pointer;" onclick="changePage('profile-view')">
                </div>
              </div>
              <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#taskEditorOffcanvas"><i data-feather="plus-circle"></i> &nbsp;New Task</button>
                <button onclick="changePage('tags-view')" class="btn" type="button" style="background-color: purple; color: white;"><i data-feather="tag"></i>&nbsp; Create Tag</button>
                <button onclick="changePage('filters-view')" class="btn btn-success" type="button"><i data-feather="layout"></i>&nbsp; Create Filter</button>
                <button onclick="changePage('vaults-view')" class="btn" type="button" style="background-color: darkcyan; color: white"><i data-feather="box"></i>&nbsp; View Vaults</button>
                <button id="viewSettingsBtn" class="btn btn-white" type="button" data-bs-toggle="offcanvas" data-bs-target="#taskSettingsOffcanvas"><i data-feather="settings"></i> &nbsp;Apply Filter</button>  
                <button data-bs-toggle="offcanvas" data-bs-target="#guide-offcanvas" class="btn" type="button" style="background-color: lightgreen; color: black;"><i data-feather="help-circle"></i>&nbsp; Help Guide</button>
              </div>
              <br><br>
              <div id="tasks-list">
                
              </div>
              <br><br><br>

              <!-- new task offcanvas -->
              <div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="taskEditorOffcanvas">
                <div class="offcanvas-header">
                  <h5 class="offcanvas-title">Task Editor</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                </div>
                <div class="offcanvas-body">
                  <form onsubmit="createNewTask()" action="javascript:void(0);">
                    <div class="mb-3">
                      <label for="task-name" class="form-label">Task Name</label>
                      <input type="text" class="form-control" id="task-name" name="task-name" required>
                    </div>
                    <div class="mb-3">
                      <label for="task-description" class="form-label">Task Description</label>
                      <textarea class="form-control" id="task-description" name="task-description"></textarea>
                    </div>
                    <div class="mb-3">
                      <label for="task-duedate" class="form-label">Due At</label>
                      <input type="datetime-local" class="form-control" id="task-duedate" name="task-duedate">
                    </div>
                    <!-- this is dynamic -->
                    <div class="mb-3">
                      <label class="form-label" for="tda2">Task Tags</label>
                      <div class="form-control" id="tda2">
                        <div id="task-tags" style="display: flex; flex-wrap: wrap; "></div>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label" for="task-priority">Task Priority</label>
                      <select name="task-priority" class="form-control" id="task-priority">
                        <option value="1">Lowest</option>
                        <option value="2">Low</option>
                        <option value="3">Medium</option>
                        <option value="4">High</option>
                        <option value="5">Highest</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label class="form-label" for="task-attachments">Add Attachments</label>
                      <input type="file" class="form-control" id="task-attachments" name="task-attachments" multiple>
                    </div><br>
                    <button id="task-editor-btn" type="submit" class="btn btn-primary">Create Task</button>
                  </form>
                </div>
              </div>
              <script>
                let taskDescription = new SimpleMDE({
                  element: document.getElementById('task-description')
                });
              </script>
              <!-- task settings offcanvas -->
              <div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="taskSettingsOffcanvas">
                <div class="offcanvas-header">
                  <h5 class="offcanvas-title">Apply a filter</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                </div>
                <div class="offcanvas-body">
                  <form id="taskViewForm">
                    <div class="mb-3">
                      <label for="taskview-filter">Select a filter: </label>
                      <select id="taskview-filter" class="form-control"></select>
                    </div>
                    <div class="mb-3">
                      <label for="taskview-showarchived">Show completed: </label>
                      <input type="checkbox" class="checkbox-round" id="taskview-showarchived">
                    </div> 
                  </form>
                </div>
              </div>
            </div>
            <div id="vaults-view" class="views">
              <h4>Vaults</h4>
              <p>Each vault contains separate tasks and tags. You can share vaults with others.</p>
              <button onclick="createNewGroup()" type="button" class="btn btn-primary">Create new vault</button>
              <br><br><br>
              <div id="vaults">
                <div class="card">
                  <div class="card-body">
                    <h5 class="card-title">(Current) Personal Vault</h5>
                    <small>
                    <i data-feather="users" style="width: 1rem;"></i> 3 people
                    &nbsp;
                    <i data-feather="check-circle" style="width: 1rem;"></i> 5 tasks
                    &nbsp;
                    <i data-feather="calendar" style="width: 1rem;"></i> Upcoming task in 3 days
                  </small>
                  </div>
                  <div class="card-body">
                    <button type="button" class="btn btn-primary">Go to vault</button>
                    <button type="button" class="btn btn-secondary">Edit vault</button>
                    <button type="button" class="btn btn-danger">Delete vault</button>
                  </div>
                </div>
              </div>
            </div>
            <div id="tags-view" class="views">
              <div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="tagsEditOffcanvas">
                <div class="offcanvas-header">
                  <button type="button" class="btn btn-danger" id="tag2-delete">Delete tag</button>
                  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                  <form onsubmit="editTag();" action="javascript:void(0);">
                    <div class="mb-3">
                      <label for="tag2-name" class="form-label">Tag name</label>
                      <input type="text" class="form-control" id="tag2-name" name="tag-name" required>
                    </div>
                    <div class="mb-3" style="position: relative;" id="tag2-anchor">
                      <label for="tag2-color" class="form-label">Tag color</label><br>
                      <input id="tag2-color" pattern="^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$" name="tag-color" type="text" class="form-control" required data-coloris>
                    </div>
                    <button type="submit" class="btn btn-primary">Edit tag</button>
                  </form><br><br><br><br>
                </div>
              </div>
              <h4>Tags Editor</h4>
              <p>Tags are labels you can apply to your tasks, which help you group and organize them.<br>
                If tags are shown below, press on one to edit it.
              </p>
              <br>
              <!-- dynamic insert -->
              <div id="tag-editor-list" style="flex-wrap: wrap;"></div><br><br>
              <div class="card">
                <div class="card-header">
                  Add new tag
                </div>
                <div class="card-body">
                  <form id="tag-form" onsubmit="createNewTag();" action="javascript:void(0);">
                    <div class="mb-3">
                      <label for="tag-name" class="form-label">Tag name</label>
                      <input type="text" class="form-control" id="tag-name" name="tag-name" required>
                    </div>
                    <div class="mb-3">
                      <label for="tag-color" class="form-label">Tag color</label><br>
                      <input id="tag-color" pattern="^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$" name="tag-color" type="text" class="form-control" required data-coloris>
                    </div>
                    <button type="submit" class="btn btn-primary">Create tag</button>
                  </form>
                </div>
              </div><br>
              <button type="button" class="btn btn-danger w-100" onclick="deleteTag(-1, true);">Clear all tags</button>
              <br><br><br><br>
            </div>
            <div id="people-view" class="views">
              <h4>Members</h4>
              <p id="people_desc">Here are the people who have access to this vault.</p>
              <button id="adduserbutton" onclick="createNewUser()" type="button" class="btn btn-outline-warning w-100"><b>ADMIN</b>: Create new user</button>
              <br><br>
              <button onclick="addPersonToVault(currentVaultId)" type="button" class="btn btn-success w-100">Invite person</button>
              <br><br><br>
              <div id="people-list">
                
              </div>
            </div>
            <div id="profile-view" class="views">
              <div class="row">
                <div class="col-10">
                  <h4 style="padding: 0; margin: 0;">My Profile</h4>
                  <span style="font-size: 12px;" id="inviteCode"></span>
                </div>
                <div class="col-2">
                  <img class="self-pfp" style="float: right; width:2.4em; border-radius: 50px;">
                </div>
              </div>
              <br><br><br>
              <button onclick="uploadPfp()" type="button" class="btn btn-primary w-100">Change profile picture</button><br><br>
              <button data-bs-toggle="offcanvas" data-bs-target="#password-ofc" type="button" class="btn btn-secondary w-100">Change password</button><br><br>
              <button onclick="changeUsername()" type="button" class="btn btn-warning w-100">Change username</button><br><br><br>
              <button id="shareCodeButton" type="button" class="btn btn-dark w-100">Copy user code</button><br><br>
              <button onclick="storage.delete('sessionToken');location.reload();" class="btn btn-danger w-100" type="button">Log out</button>
              <div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="password-ofc">
                <div class="offcanvas-header">
                  <h5 class="offcanvas-title">Change Password</h5>
                  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                  <form action="javascript:void(0);" onsubmit="changePassword()">
                    <div class="mb-3">
                      <label for="password-1">Enter your new password: </label>
                      <input type="password" class="form-control" name="password-1" id="password-1">
                    </div>
                    <div class="mb-3">
                      <label for="password-2">Confirm password: </label>
                      <input type="password" class="form-control" name="password-2" id="password-2">
                    </div>
                    <button type="submit" class="btn btn-primary">Change password</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <form id="dldl" class="display:none;"></form>

    <script src="main.js"></script>

  </body>
</html>